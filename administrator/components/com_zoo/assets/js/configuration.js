/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(a){var o=function(){};o.prototype=a.extend(o.prototype,{name:"ApplicationEdit",options:{url:"index.php?option=com_zoo&controller=configuration",config_url:"index.php?option=com_config&task=config.store&format=raw",application_id:0,application_group:""},initialize:function(s,i){this.options=a.extend({},this.options,i);var t=this,n=a("#parameter-accordion"),l=a("#template"),u=a("#zoo-permissions");l.on("change",function(){var r=a('<span class="loader">').insertAfter(l);n.fadeOut(),a.ajax({url:t.options.url,data:{task:"getApplicationParams",format:"raw","cid[]":t.options.application_id,group:t.options.application_group,template:a(this).val()},success:function(c){n.html(c).fadeIn().accordionMenu({mode:"slide",display:0}),r.remove()}})}),u.find("select").change(function(){t.sendPermissions(this)})},sendPermissions:function(s){var i=a(s),t=a(document.getElementById("icon_"+i.attr("id"))),n="com_zoo.application."+this.options.application_id,l=a("input[name=alias]").val(),u=i.val(),r=i.attr("id").split("_"),c=r[1]!=="application"?r[1]:!1,m="GET",p=i.closest("[data-ajaxuri],[data-uri]");c!==!1&&(n+="."+c,l+=" ("+c+")"),t.attr("class",""),t.attr("style","background: url(../media/system/images/modal/spinner.gif); display: inline-block; width: 16px; height: 16px"),p.length&&(m="POST",this.options.config_url=p.data("ajaxuri")||p.data("uri"));var d={method:m,url:this.options.config_url,datatype:"json",data:{comp:n,action:r[2],rule:r[3],value:u,title:l}};p.data("uri")&&(d.contentType="application/json",d.data=JSON.stringify(d.data)),a.ajax(d).fail(function(e,f,g){t.attr("style",""),Joomla.renderMessages(Joomla.ajaxErrorsMessages(e,f,g)),window.scrollTo(0,0),t.attr("class","icon-cancel")}).done(function(e){t.attr("style",""),e.data&&e.data.result==!0&&(t.attr("class","icon-save"),i.parents().next("td").find("span").attr("class",e.data.class).html(e.data.text)),typeof e.messages=="object"&&e.messages!==null&&(Joomla.renderMessages(e.messages),e.data&&e.data.result==!0?t.attr("class","icon-save"):t.attr("class","icon-cancel"),window.scrollTo(0,0))})}}),a.fn[o.prototype.name]=function(){var s=arguments,i=s[0]?s[0]:null;return this.each(function(){var t=a(this);if(o.prototype[i]&&t.data(o.prototype.name)&&i!="initialize")t.data(o.prototype.name)[i].apply(t.data(o.prototype.name),Array.prototype.slice.call(s,1));else if(!i||a.isPlainObject(i)){var n=new o;o.prototype.initialize&&n.initialize.apply(n,a.merge([t],s)),t.data(o.prototype.name,n)}else a.error("Method "+i+" does not exist on jQuery."+o.name)})}})(jQuery);
