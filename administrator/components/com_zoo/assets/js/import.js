/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(t){var a=function(){};a.prototype=t.extend(a.prototype,{name:"ImportExport",options:{msgImportWarning:"Please choose a file first!"},initialize:function(e,n){this.options=t.extend({},this.options,n);var o=this;e.find("div.uploadbox").each(function(){var s=t(this).find("input.filename");t(this).find('input[name^="import-"]').on("change",function(){s.val(this.value)}),t(this).find("button.upload").on("click",function(){s.val()==""?alert(o.options.msgImportWarning):Joomla.submitbutton("import")})}),e.find("a.exporter-link").each(function(){var s=t(this);s.on("click",function(){e.find('input[name="exporter"]').val(s.attr("id")),Joomla.submitbutton("importfrom")})}),e.find("button.export").on("click",function(){var s=e.find('input[name="format"]');s.val("raw"),e.find('input[name="exporter"]').val("zoo2"),Joomla.submitbutton(t(this).data("task")),s.val("html")})}}),t.fn[a.prototype.name]=function(){var e=arguments,n=e[0]?e[0]:null;return this.each(function(){var o=t(this);if(a.prototype[n]&&o.data(a.prototype.name)&&n!="initialize")o.data(a.prototype.name)[n].apply(o.data(a.prototype.name),Array.prototype.slice.call(e,1));else if(!n||t.isPlainObject(n)){var s=new a;a.prototype.initialize&&s.initialize.apply(s,t.merge([o],e)),o.data(a.prototype.name,s)}else t.error("Method "+n+" does not exist on jQuery."+a.name)})}})(jQuery),function(t){var a=function(){};a.prototype=t.extend(a.prototype,{name:"Import",options:{msgSelectWarning:"You didn't assign all item types. Items of these types will not be imported. Do you want to proceed anyway?",msgWarningDuplicate:"There are duplicate assignments.",msgNameWarning:"Please choose a name column.",task:"doimport"},initialize:function(e,n){this.options=t.extend({},this.options,n);var o=this;this.form=e,e.find("fieldset.frontpage, fieldset.categories").each(function(){var s=t(this);s.find('input[name^="import-"]').on("change",function(){t(this).is(":checked")?s.find("div.assign-group").show():s.find("div.assign-group").hide()})}),e.find("fieldset.items").each(function(){var s=t(this);s.find("select.type").on("change",function(){var l=t(this),p=new RegExp("\\["+l.val()+"\\]$");s.find("li.assign select.assign").each(function(){var r=t(this);if(r.attr("name").match(p)){var c=r.nextAll(".name").text().trim();r.show().find("option").each(function(){t(this).text().replace(/\(.*\)/i,"").trim()==c&&r.val(t(this).val())})}else r.hide()})})}),t("#submit-button").on("click",function(){o.options.task!="doimportcsv"&&o.hasDuplicateSelectedAssignments()?alert(o.options.msgWarningDuplicate):o.options.task=="doimportcsv"&&!o.hasNameAssigned()?alert(o.options.msgNameWarning):o.hasUnassignedTypes()&&!confirm(o.options.msgSelectWarning)||Joomla.submitbutton(o.options.task)})},hasNameAssigned:function(){var e=!1;return this.form.find("div.assign-group").each(function(){var n=new RegExp("\\["+t(this).find("select.type").val()+"\\]$");t(this).find("select.assign").each(function(){if(t(this).attr("name").match(n)&&t(this).val()=="_name"){e=!0;return}})}),e},hasUnassignedTypes:function(){var e=!1;return this.form.find("select.type").each(function(){if(t(this).val()==""){e=!0;return}}),e},hasDuplicateSelectedAssignments:function(){var e=!1;return this.form.find("div.assign-group").each(function(){var n=t(this).find("select.assign");for(i=0;i<n.length;i++)for(j=i+1;j<n.length;j++)if(value_a=t(n.get(i)).val(),value_b=t(n.get(j)).val(),value_a!=""&&value_a!="_category"&&value_a==value_b){e=!0;return}}),e}}),t.fn[a.prototype.name]=function(){var e=arguments,n=e[0]?e[0]:null;return this.each(function(){var o=t(this);if(a.prototype[n]&&o.data(a.prototype.name)&&n!="initialize")o.data(a.prototype.name)[n].apply(o.data(a.prototype.name),Array.prototype.slice.call(e,1));else if(!n||t.isPlainObject(n)){var s=new a;a.prototype.initialize&&s.initialize.apply(s,t.merge([o],e)),o.data(a.prototype.name,s)}else t.error("Method "+n+" does not exist on jQuery."+a.name)})}}(jQuery);
