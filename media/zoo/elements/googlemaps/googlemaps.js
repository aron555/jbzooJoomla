/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(e){var n=function(){};e.extend(n.prototype,{name:"Googlemaps",options:{lat:53.553407,lng:9.992196,marker:!0,popup:!1,text:"",zoom:13,mapCtrl:2,zoomWhl:!0,mapType:0,typeCtrl:!0,overviewCtrl:!0,directions:!0,directionsDestUpdate:!1,directionsTravelMode:0,locale:"en",mainIcon:"red-dot",otherIcon:"blue-dot",iconUrl:"https://maps.google.com/mapfiles/ms/micons/",msgFromAddress:"From address: ",msgGetDirections:"Get directions",msgEmpty:"Please fill in your address.",msgNotFound:"Sorry, address not found!",msgAddressNotFound:", not found!"},initialize:function(i,t){this.options=e.extend({},this.options,t),this.container=i,this.setupMap(),this.options.directions&&this.setupDirections()},setupMap:function(){this.map=new google.maps.Map(this.container.get(0),{mapTypeId:google.maps.MapTypeId.ROADMAP}),this.map.setOptions({navigationControl:this.options.mapCtrl==1||this.options.mapCtrl==2}),this.map.setOptions({navigationControlOptions:{style:this.options.mapCtrl==1?google.maps.NavigationControlStyle.SMALL:google.maps.NavigationControlStyle.DEFAULT}}),this.map.setOptions({scrollwheel:!!this.options.zoomWhl}),this.options.mapType==1&&this.map.setOptions({mapTypeId:google.maps.MapTypeId.SATELLITE}),this.options.mapType==2&&this.map.setOptions({mapTypeId:google.maps.MapTypeId.HYBRID}),this.options.mapType==3&&this.map.setOptions({mapTypeId:google.maps.MapTypeId.TERRAIN}),this.map.setOptions({mapTypeControl:!!this.options.typeCtrl}),this.infowindow=new google.maps.InfoWindow,this.options.marker?this.addMarkerLatLng(this.options.lat,this.options.lng,this.options.text,!0):this.centerMap(this.options.lat,this.options.lng)},createMarker:function(i,t,o){var s=this,p=this.map,a=this.infowindow,l=new google.maps.MarkerImage(this.options.iconUrl+o+".png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32)),m=o.match("pushpin")?this.options.iconUrl+"pushpin_shadow.png":this.options.iconUrl+"msmarker.shadow.png",h=new google.maps.MarkerImage(m,new google.maps.Size(56,32),new google.maps.Point(0,0),new google.maps.Point(16,32)),r=new google.maps.Marker({position:i,icon:l,shadow:h,map:this.map});return(t||this.options.directionsDestUpdate)&&google.maps.event.addListener(r,"click",function(){t&&(a.setContent(t),a.open(p,r)),s.options.directionsDestUpdate&&(s.options.lat=r.getPosition().lat(),s.options.lng=r.getPosition().lng())}),r},centerMap:function(i,t){var o=new google.maps.LatLng(i,t);this.map.setCenter(o),this.map.setZoom(this.options.zoom)},addMarkerLatLng:function(i,t,o,s){var p=this.options.otherIcon;s&&(p=this.options.mainIcon);var a=new google.maps.LatLng(i,t),l=this.createMarker(a,o,p);s&&(this.map.setCenter(a),this.map.setZoom(this.options.zoom)),s&&o&&this.options.popup&&(this.infowindow.setContent(o),this.infowindow.open(this.map,l))},setupDirections:function(){var i=this;this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,this.directionsDisplay.setMap(this.map),this.directionsDisplay.setPanel(e("<div>").addClass("directions").css("position","relative").insertAfter(this.container).get(0));var t=e("<p>").append('<label for="from-address">'+this.options.msgFromAddress+"</label>").append('<input type="text" name="address" style="margin:0 5px;" />').append('<button type="submit">'+this.options.msgGetDirections+"</button>");e('<form method="get" action="#"></form>').append(t).insertAfter(this.container).bind("submit",function(o){o.preventDefault(),o.stopPropagation(),i.setDirections(e(this))})},setDirections:function(i){var t=this;this.container.parent().find("div.alert").remove();var o=i.find('input[name="address"]').val();if(o==="")this.showAlert(this.options.msgEmpty);else{var s={origin:o,destination:new google.maps.LatLng(this.options.lat,this.options.lng),travelMode:google.maps.DirectionsTravelMode.DRIVING,region:this.options.locale};this.directionsService.route(s,function(p,a){a==google.maps.DirectionsStatus.OK?t.directionsDisplay.setDirections(p):t.showAlert(t.options.msgNotFound)})}},showAlert:function(i){e("<div>").addClass("alert").append(e("<strong>").text(i)).insertAfter(this.container)},refresh:function(){google.maps.event.trigger(this.map,"resize"),this.centerMap(this.options.lat,this.options.lng)}}),e.fn[n.prototype.name]=function(){var i=arguments,t=i[0]?i[0]:null;return this.each(function(){var o=e(this);if(n.prototype[t]&&o.data(n.prototype.name)&&t!="initialize")o.data(n.prototype.name)[t].apply(o.data(n.prototype.name),Array.prototype.slice.call(i,1));else if(!t||e.isPlainObject(t)){var s=new n;n.prototype.initialize&&s.initialize.apply(s,e.merge([o],i)),o.data(n.prototype.name,s)}else e.error("Method "+t+" does not exist on jQuery."+n.name)})}})(jQuery);
