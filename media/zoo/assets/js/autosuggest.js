/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(t){var a=function(){};t.extend(a.prototype,{name:"autosuggest",options:{prefill:"",allowDuplicates:!0,inputName:"term[]",resultsHighlight:!0,addButtonText:"Add"},initialize:function(e,o){this.options=t.extend({},this.options,o);var i=this;this.input=e,t.extend(t.expr[":"],{focus:function(s){return s==document.activeElement}}),e.addClass("as-input").wrap('<ul class="as-selections">').wrap('<li class="as-original">').autocomplete(t.extend({select:function(s,l){i.addItem(l.item),l.item.value=l.item.label=""}},this.options)).on("blur",function(s){i.selections_holder.addClass("blur").find("li.as-selection-item").removeClass("selected")}).on("focus",function(){i.selections_holder.removeClass("blur")}).on("keydown",function(s){switch(s.which){case 8:e.val()==""&&(s.preventDefault(),li=t("li.as-selection-item:last"),li.is(".selected")?i.removeItem(li):i.selectItem(li));break;case 9:s.preventDefault(),i.addItem(e.val());break}}).on("keypress",function(s){s.charCode==44&&(s.preventDefault(),i.addItem(e.val()))}),this.selections_holder=e.closest("ul.as-selections").on("click",function(){e.not(":focus")&&e.focus()}),this.original=this.selections_holder.find("li.as-original"),t('<li class="add-tag-button" >').insertAfter(this.original).text(this.options.addButtonText).on("click",function(){t.each(e.val().split(","),function(s,l){i.addItem(l)})}),typeof this.options.prefill=="string"?t.each(this.options.prefill.split(","),function(s,l){i.addItem(l)}):i.addItem(this.options.prefill),e.is(":focus")?e.focus():e.blur(),this.selections_holder.on("click","a.as-close",function(){i.removeItem(t(this).parent())}).on("click","li.as-selection-item",function(){i.selectItem(this)})},addItem:function(e){if(typeof e=="string"&&(e={label:e.trim(),value:e.trim()}),e.value!=""&&(this.options.allowDuplicates||!this.itemExists(e))){var o=t('<li class="as-selection-item">').text(e.label).data("item",e).insertBefore(this.original);t('<a class="as-close">&times;</a>').appendTo(o),t('<input type="hidden" class="as-value">').attr("name",this.options.inputName).val(e.value).appendTo(o)}this.input.val(""),this.input.trigger("addItem",o)},removeItem:function(e){e.remove()},itemExists:function(e){var o=!1;return this.selections_holder.find("li.as-selection-item").each(function(){if(t(this).data("item")&&t(this).data("item").value.toLowerCase()==e.value.toLowerCase()){o=!0;return}}),o},selectItem:function(e){t("li.as-selection-item",this.selections_holder).not(e).removeClass("selected"),t(e).addClass("selected"),this.input.not(":focus")&&this.input.focus()}}),t.fn[a.prototype.name]=function(){var e=arguments,o=e[0]?e[0]:null;return this.each(function(){var i=t(this);if(a.prototype[o]&&i.data(a.prototype.name)&&o!="initialize")i.data(a.prototype.name)[o].apply(i.data(a.prototype.name),Array.prototype.slice.call(e,1));else if(!o||t.isPlainObject(o)){var s=new a;a.prototype.initialize&&s.initialize.apply(s,t.merge([i],e)),i.data(a.prototype.name,s)}else t.error("Method "+o+" does not exist on jQuery."+a.name)})}})(jQuery);
