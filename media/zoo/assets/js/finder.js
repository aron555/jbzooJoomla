/* Copyright (C) YOOtheme GmbH, https://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(e){var t=function(){};e.extend(t.prototype,{name:"finder",initialize:function(o,n){var i=this;this.options=e.extend({url:"",path:"",open:"open",loading:"loading"},n),o.data("path",this.options.path).on("retrieve:finder",a).trigger("retrieve:finder");function a(l){l.preventDefault();var r=e(this).closest("li",o);r.length||(r=o),r.hasClass(i.options.open)?r.removeClass(i.options.open).children("ul").slideUp():(r.addClass(i.options.loading),e.post(i.options.url,{path:r.data("path")},function(s){r.removeClass(i.options.loading).addClass(i.options.open),s.length&&(r.children().remove("ul"),r.append("<ul>").children("ul").hide(),e.each(s,function(p,d){r.children("ul").append(e('<li><a href="#">'+d.name+"</a></li>").addClass(d.type).data("path",d.path))}),r.find("ul a").on("click",a),r.children("ul").slideDown())},"json"))}}}),e.fn[t.prototype.name]=function(){var o=arguments,n=o[0]?o[0]:null;return this.each(function(){var i=e(this);if(t.prototype[n]&&i.data(t.prototype.name)&&n!="initialize")i.data(t.prototype.name)[n].apply(i.data(t.prototype.name),Array.prototype.slice.call(o,1));else if(!n||e.isPlainObject(n)){var a=new t;t.prototype.initialize&&a.initialize.apply(a,e.merge([i],o)),i.data(t.prototype.name,a)}else e.error("Method "+n+" does not exist on jQuery."+t.name)})}})(jQuery),function(e){var t=function(){};e.extend(t.prototype,{name:"Directories",initialize:function(o,n){this.options=e.extend({url:"",title:"Folders",mode:"folder",msgDelete:"Delete"},n);var i=this,a=e('<div class="finder" />').insertAfter(o).finder(this.options).on("click","a",function(s){a.find("li").removeClass("selected");var p=e(this).parent().addClass("selected");(i.options.mode!=="file"||p.hasClass("file"))&&o.focus().val(p.data("path")).blur()}),l=a.dialog(e.extend({autoOpen:!1,resizable:!1,open:function(){l.position({of:r,my:"center top",at:"center bottom"})}},this.options)).dialog("widget"),r=e('<span title="'+this.options.title+'" class="'+this.options.mode+'s" />').insertAfter(o).on("click",function(){a.dialog(a.dialog("isOpen")?"close":"open")});e('<span title="'+this.options.msgDelete+'" class="delete-file" />').insertAfter(o).on("click",function(){o.val("")}),e("body").on("click",function(s){a.dialog("isOpen")&&!r.is(s.target)&&!l.find(s.target).length&&a.dialog("close")})}}),e.fn[t.prototype.name]=function(){var o=arguments,n=o[0]?o[0]:null;return this.each(function(){var i=e(this);if(t.prototype[n]&&i.data(t.prototype.name)&&n!="initialize")i.data(t.prototype.name)[n].apply(i.data(t.prototype.name),Array.prototype.slice.call(o,1));else if(!n||e.isPlainObject(n)){var a=new t;t.prototype.initialize&&a.initialize.apply(a,e.merge([i],o)),i.data(t.prototype.name,a)}else e.error("Method "+n+" does not exist on jQuery."+t.name)})}}(jQuery);
